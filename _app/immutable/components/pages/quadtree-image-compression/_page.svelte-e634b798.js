import{S as pe,i as $e,s as _e,w as P,x as T,y as R,f as H,t as x,z as F,o as be,k as A,l as N,m as V,h as w,n as W,b as re,B as ve,J as ue,K as me,q as O,a as G,r as j,c as K,G as b,u as he,M as de}from"../../../chunks/index-6be07ad6.js";import{M as we,S as Ie,T as Ce}from"../../../chunks/Main-d501f058.js";import{S as ke}from"../../../chunks/Seo-8afd16e9.js";import{D as Ee}from"../../../chunks/DemoContainer-02f198f6.js";import{I as De}from"../../../chunks/ImageSelect-24d6df7c.js";import{N as ge}from"../../../chunks/NumberRange-767509e5.js";import{C as Se}from"../../../chunks/Checkbox-10baa3e8.js";import{d as ze}from"../../../chunks/core-ddcb889b.js";function Le(o){let e;return{c(){e=A("canvas"),this.h()},l(n){e=N(n,"CANVAS",{slot:!0,class:!0}),V(e).forEach(w),this.h()},h(){W(e,"slot","canvas"),W(e,"class","svelte-10p45u9")},m(n,t){re(n,e,t),o[13](e)},p:ve,d(n){n&&w(e),o[13](null)}}}function Me(o){let e,n,t,h,r,m,u,s,d,S,C,E,Y,J,ie,te,M,U,le,B,X,oe,ce,y,fe,p,l,a,i,f;function g(c){o[8](c)}let v={id:"depth",min:Qe,max:Be,step:1,onChange:o[7]};o[3]!==void 0&&(v.value=o[3]),s=new ge({props:v}),ue.push(()=>me(s,"value",g,o[3]));function Z(c){o[9](c)}let q={id:"colordifference",min:qe,max:Ae,step:.01,onChange:o[7]};o[5]!==void 0&&(q.value=o[5]),M=new ge({props:q}),ue.push(()=>me(M,"value",Z,o[5]));function ne(c){o[10](c)}let z={id:"showbounds",onChange:o[6]};o[4]!==void 0&&(z.checked=o[4]),y=new Se({props:z}),ue.push(()=>me(y,"checked",ne,o[4]));function k(c){o[12](c)}let se={id:"image-select",onChange:o[11]};return o[2]!==void 0&&(se.value=o[2]),a=new De({props:se}),ue.push(()=>me(a,"value",k,o[2])),{c(){e=A("fieldset"),n=A("div"),t=A("label"),h=O("Depth: ("),r=O(o[3]),m=O(")"),u=G(),P(s.$$.fragment),S=G(),C=A("div"),E=A("label"),Y=O("Color Diff: ("),J=O(o[5]),ie=O(")"),te=G(),P(M.$$.fragment),le=G(),B=A("div"),X=A("label"),oe=O("Show Bounds"),ce=G(),P(y.$$.fragment),p=G(),l=A("div"),P(a.$$.fragment),this.h()},l(c){e=N(c,"FIELDSET",{slot:!0});var $=V(e);n=N($,"DIV",{class:!0});var I=V(n);t=N(I,"LABEL",{for:!0});var _=V(t);h=j(_,"Depth: ("),r=j(_,o[3]),m=j(_,")"),_.forEach(w),u=K(I),T(s.$$.fragment,I),I.forEach(w),S=K($),C=N($,"DIV",{class:!0});var D=V(C);E=N(D,"LABEL",{for:!0});var L=V(E);Y=j(L,"Color Diff: ("),J=j(L,o[5]),ie=j(L,")"),L.forEach(w),te=K(D),T(M.$$.fragment,D),D.forEach(w),le=K($),B=N($,"DIV",{class:!0});var ee=V(B);X=N(ee,"LABEL",{for:!0});var ae=V(X);oe=j(ae,"Show Bounds"),ae.forEach(w),ce=K(ee),T(y.$$.fragment,ee),ee.forEach(w),p=K($),l=N($,"DIV",{class:!0});var Q=V(l);T(a.$$.fragment,Q),Q.forEach(w),$.forEach(w),this.h()},h(){W(t,"for","depth"),W(n,"class","demo-input-group"),W(E,"for","colordifference"),W(C,"class","demo-input-group"),W(X,"for","showbounds"),W(B,"class","demo-input-group"),W(l,"class","demo-input-group"),W(e,"slot","controls")},m(c,$){re(c,e,$),b(e,n),b(n,t),b(t,h),b(t,r),b(t,m),b(n,u),R(s,n,null),b(e,S),b(e,C),b(C,E),b(E,Y),b(E,J),b(E,ie),b(C,te),R(M,C,null),b(e,le),b(e,B),b(B,X),b(X,oe),b(B,ce),R(y,B,null),b(e,p),b(e,l),R(a,l,null),f=!0},p(c,$){(!f||$&8)&&he(r,c[3]);const I={};!d&&$&8&&(d=!0,I.value=c[3],de(()=>d=!1)),s.$set(I),(!f||$&32)&&he(J,c[5]);const _={};!U&&$&32&&(U=!0,_.value=c[5],de(()=>U=!1)),M.$set(_);const D={};!fe&&$&16&&(fe=!0,D.checked=c[4],de(()=>fe=!1)),y.$set(D);const L={};$&6&&(L.onChange=c[11]),!i&&$&4&&(i=!0,L.value=c[2],de(()=>i=!1)),a.$set(L)},i(c){f||(H(s.$$.fragment,c),H(M.$$.fragment,c),H(y.$$.fragment,c),H(a.$$.fragment,c),f=!0)},o(c){x(s.$$.fragment,c),x(M.$$.fragment,c),x(y.$$.fragment,c),x(a.$$.fragment,c),f=!1},d(c){c&&w(e),F(s),F(M),F(y),F(a)}}}function ye(o){let e,n;return e=new Ee({props:{caption:"Quadtree Image Compression",id:"quadtree-image-compression-demo",$$slots:{controls:[Me],canvas:[Le]},$$scope:{ctx:o}}}),{c(){P(e.$$.fragment)},l(t){T(e.$$.fragment,t)},m(t,h){R(e,t,h),n=!0},p(t,[h]){const r={};h&8388671&&(r.$$scope={dirty:h,ctx:t}),e.$set(r)},i(t){n||(H(e.$$.fragment,t),n=!0)},o(t){x(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}const Qe=1,Be=8,qe=0,Ae=.3;function Ne(o,e,n,t,h,r){const m=(e-o)/255,u=(t-n)/255,s=(r-h)/255;return Math.sqrt(m*m+u*u+s*s)}function Ve(o,e,n){let t=0,h,r,m,u=0,s=0,d,S,C="/images/starrynight.webp",E=6,Y=!0,J=.1;class ie{constructor(l,a,i=Number.POSITIVE_INFINITY){this.node=new te(l,a),this.depth=i}insert(l,a=this.node){if(a.children===null)if(a.data){if(a.data[0]===l[0]&&a.data[1]===l[1])return;if(this.getDepth(a)>=this.depth)a.data.push(l[2],l[3],l[4]);else{const g=[...a.data];a.data=null,a.divide();for(let v=0;v<a.children.length;v++)a.children[v].data=[...g];this.insert(l,a)}}else a.data=[l[2],l[3],l[4]];else{const f=this.getIndex(a.center,l);this.insert(l,a.children[f])}}getIndex(l,a){let i=0;return i|=l[0]>a[0]?0:1,i|=l[1]>a[1]?0:2,i}getDepth(l){const a=this.node.size[0];let i=l.size[0],f=0;for(;a>i;)i*=2,f++;return f}}class te{constructor(l,a){this.center=l,this.size=a,this.children=null,this.data=null}divide(){this.children=new Array(4);for(let l=0;l<this.children.length;l++){const a=[...this.center],i=this.size[0]*.25,f=this.size[1]*.25;(l&1)===1?a[0]+=i:a[0]-=i,(l&2)===2?a[1]+=f:a[1]-=f,this.children[l]=new te(a,[this.size[0]*.5,this.size[1]*.5])}}}be(()=>{m=r.getContext("2d"),h=document.getElementById("quadtree-image-compression-demo"),t=Math.floor(window.innerWidth);function p(){const a=Math.floor(window.innerWidth);a!==t&&(t=a,l())}function l(){const a=h.clientWidth,i=window.innerHeight-window.innerHeight/4;if(u=d.width,s=d.height,a>0&&i>0){if(u>a){const f=a/u;u*=f,s*=f}if(s>i){const f=i/s;u*=f,s*=f}u=Math.floor(u),s=Math.floor(s)}n(0,r.width=u,r),n(0,r.height=s,r),n(0,r.style.width=`${u}px`,r),n(0,r.style.height=`${s}px`,r),M()}return n(1,d=new Image),n(1,d.crossOrigin="anonymous",d),n(1,d.onload=l,d),n(1,d.src=C,d),window.addEventListener("resize",p,{passive:!0}),()=>{window.removeEventListener("resize",p)}});function M(){const p=document.createElement("canvas"),l=p.getContext("2d");p.width=u,p.height=s,!(u===0||s===0)&&(l.drawImage(d,0,0,d.width,d.height,0,0,u,s),S=l.getImageData(0,0,u,s).data,U())}function U(){const p=new ie([u/2,s/2],[u,s],E),l=i=>{const{center:f,size:g}=i;if(Y&&(m.lineWidth=1,m.strokeStyle="black",m.fillStyle="black",m.strokeRect(f[0]-g[0]/2,f[1]-g[1]/2,g[0],g[1])),i.data){let v=0,Z=0,q=0;for(let k=0;k<i.data.length;k+=3)v+=i.data[k],Z+=i.data[k+1],q+=i.data[k+2];const ne=i.data.length/3;v/=ne,Z/=ne,q/=ne;const z=`rgb(${v},${Z},${q})`;m.fillStyle=z,m.strokeStyle=z,m.fillRect(f[0]-g[0]/2,f[1]-g[1]/2,g[0],g[1]),m.strokeRect(f[0]-g[0]/2,f[1]-g[1]/2,g[0],g[1])}if(i.children)for(let v=0;v<i.children.length;v++)l(i.children[v])};for(let i=0;i<S.length;i+=4){const f=i/4%u,g=Math.floor(i/4/u);p.insert([f,g,S[i],S[i+1],S[i+2]])}const a=(i,f)=>{let g=i,v=!1;const Z=(q,ne=0)=>{if(q.children)g=q,q.children.forEach((z,k)=>Z(z,k));else{if(!g.children||ne!==3)return;let z=0,k=0,se=0,c=0;for(let I=0;I<g.children.length;I++){const _=g.children[I],D=_.data.length/3;c+=D;let L=0,ee=0,ae=0;for(let Q=0;Q<_.data.length;Q+=3)z+=_.data[Q],k+=_.data[Q+1],se+=_.data[Q+2],L+=_.data[Q],ee+=_.data[Q+1],ae+=_.data[Q+2];L/=D,ee/=D,ae/=D,_.data=[L,ee,ae]}z/=c,k/=c,se/=c;let $=!0;for(let I=0;I<g.children.length;I++){const _=g.children[I].data;Ne(z,_[0],k,_[1],se,_[2])>f&&($=!1)}$&&(v=!0,g.children=null,g.data=[z,k,se])}};Z(i),v&&a(i,f)};a(p.node,J),l(p.node)}const le=ze(U,200);function B(p){E=p,n(3,E)}function X(p){J=p,n(5,J)}function oe(p){Y=p,n(4,Y)}const ce=()=>{n(1,d.src=C,d),U()};function y(p){C=p,n(2,C)}function fe(p){ue[p?"unshift":"push"](()=>{r=p,n(0,r)})}return[r,d,C,E,Y,J,U,le,B,X,oe,ce,y,fe]}class We extends pe{constructor(e){super(),$e(this,e,Ve,ye,_e,{})}}function Pe(o){let e;return{c(){e=O("Quadtree Image Compression")},l(n){e=j(n,"Quadtree Image Compression")},m(n,t){re(n,e,t)},d(n){n&&w(e)}}}function Te(o){let e,n,t,h,r,m,u;return e=new Ce({props:{timestamp:1652155200,$$slots:{default:[Pe]},$$scope:{ctx:o}}}),m=new We({}),{c(){P(e.$$.fragment),n=G(),t=A("p"),h=O(`I'm noticing seams at higher depths. I assume it's due to a rounding
			error somewhere.`),r=G(),P(m.$$.fragment)},l(s){T(e.$$.fragment,s),n=K(s),t=N(s,"P",{});var d=V(t);h=j(d,`I'm noticing seams at higher depths. I assume it's due to a rounding
			error somewhere.`),d.forEach(w),r=K(s),T(m.$$.fragment,s)},m(s,d){R(e,s,d),re(s,n,d),re(s,t,d),b(t,h),re(s,r,d),R(m,s,d),u=!0},p(s,d){const S={};d&1&&(S.$$scope={dirty:d,ctx:s}),e.$set(S)},i(s){u||(H(e.$$.fragment,s),H(m.$$.fragment,s),u=!0)},o(s){x(e.$$.fragment,s),x(m.$$.fragment,s),u=!1},d(s){F(e,s),s&&w(n),s&&w(t),s&&w(r),F(m,s)}}}function Re(o){let e,n;return e=new Ie({props:{$$slots:{default:[Te]},$$scope:{ctx:o}}}),{c(){P(e.$$.fragment)},l(t){T(e.$$.fragment,t)},m(t,h){R(e,t,h),n=!0},p(t,h){const r={};h&1&&(r.$$scope={dirty:h,ctx:t}),e.$set(r)},i(t){n||(H(e.$$.fragment,t),n=!0)},o(t){x(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function He(o){let e,n,t,h;return e=new ke({props:{title:"Quadtree Image Compression",description:"Compress an image using a Quadtree",keywords:"Javascript, Creative Coding, Quadtree, Image Compression, Image Processing"}}),t=new we({props:{$$slots:{default:[Re]},$$scope:{ctx:o}}}),{c(){P(e.$$.fragment),n=G(),P(t.$$.fragment)},l(r){T(e.$$.fragment,r),n=K(r),T(t.$$.fragment,r)},m(r,m){R(e,r,m),re(r,n,m),R(t,r,m),h=!0},p(r,[m]){const u={};m&1&&(u.$$scope={dirty:m,ctx:r}),t.$set(u)},i(r){h||(H(e.$$.fragment,r),H(t.$$.fragment,r),h=!0)},o(r){x(e.$$.fragment,r),x(t.$$.fragment,r),h=!1},d(r){F(e,r),r&&w(n),F(t,r)}}}class Ue extends pe{constructor(e){super(),$e(this,e,null,He,_e,{})}}export{Ue as default};
