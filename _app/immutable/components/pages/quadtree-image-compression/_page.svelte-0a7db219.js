import{S as $e,i as _e,s as be,w as S,x as z,y as L,f as M,t as Q,z as B,o as ve,k as F,l as R,m as H,h as $,n as K,b as V,B as we,J as ue,K as me,q as J,a as N,r as O,c as P,G as _,u as he,M as de}from"../../../chunks/index-a4a97fa6.js";import{S as Ie}from"../../../chunks/Seo-3e94c9ab.js";import{M as Ce,F as ke,S as ge,T as Ee,a as De}from"../../../chunks/Footer-cc357b56.js";import{D as Se}from"../../../chunks/DemoContainer-abd5cee0.js";import{I as ze}from"../../../chunks/ImageSelect-6b6f6191.js";import{N as pe}from"../../../chunks/NumberRange-8f4747ca.js";import{C as Le}from"../../../chunks/Checkbox-09103b41.js";import{d as Me}from"../../../chunks/core-2382e8f7.js";function Qe(c){let e;return{c(){e=F("canvas"),this.h()},l(s){e=R(s,"CANVAS",{slot:!0,class:!0}),H(e).forEach($),this.h()},h(){K(e,"slot","canvas"),K(e,"class","svelte-10p45u9")},m(s,r){V(s,e,r),c[13](e)},p:we,d(s){s&&$(e),c[13](null)}}}function Be(c){let e,s,r,h,a,i,t,n,m,q,C,E,U,Y,ie,ne,W,X,le,j,Z,oe,fe,x,ce,p,f,l,o,d;function g(u){c[8](u)}let w={id:"depth",min:ye,max:Ae,step:1,onChange:c[7]};c[3]!==void 0&&(w.value=c[3]),n=new pe({props:w}),ue.push(()=>me(n,"value",g));function ee(u){c[9](u)}let G={id:"colordifference",min:Ne,max:Pe,step:.01,onChange:c[7]};c[5]!==void 0&&(G.value=c[5]),W=new pe({props:G}),ue.push(()=>me(W,"value",ee));function se(u){c[10](u)}let y={id:"showbounds",onChange:c[6]};c[4]!==void 0&&(y.checked=c[4]),x=new Le({props:y}),ue.push(()=>me(x,"checked",se));function k(u){c[12](u)}let re={id:"image-select",onChange:c[11]};return c[2]!==void 0&&(re.value=c[2]),l=new ze({props:re}),ue.push(()=>me(l,"value",k)),{c(){e=F("fieldset"),s=F("div"),r=F("label"),h=J("Depth: ("),a=J(c[3]),i=J(")"),t=N(),S(n.$$.fragment),q=N(),C=F("div"),E=F("label"),U=J("Color Diff: ("),Y=J(c[5]),ie=J(")"),ne=N(),S(W.$$.fragment),le=N(),j=F("div"),Z=F("label"),oe=J("Show Bounds"),fe=N(),S(x.$$.fragment),p=N(),f=F("div"),S(l.$$.fragment),this.h()},l(u){e=R(u,"FIELDSET",{slot:!0});var b=H(e);s=R(b,"DIV",{class:!0});var I=H(s);r=R(I,"LABEL",{for:!0});var v=H(r);h=O(v,"Depth: ("),a=O(v,c[3]),i=O(v,")"),v.forEach($),t=P(I),z(n.$$.fragment,I),I.forEach($),q=P(b),C=R(b,"DIV",{class:!0});var D=H(C);E=R(D,"LABEL",{for:!0});var A=H(E);U=O(A,"Color Diff: ("),Y=O(A,c[5]),ie=O(A,")"),A.forEach($),ne=P(D),z(W.$$.fragment,D),D.forEach($),le=P(b),j=R(b,"DIV",{class:!0});var te=H(j);Z=R(te,"LABEL",{for:!0});var ae=H(Z);oe=O(ae,"Show Bounds"),ae.forEach($),fe=P(te),z(x.$$.fragment,te),te.forEach($),p=P(b),f=R(b,"DIV",{class:!0});var T=H(f);z(l.$$.fragment,T),T.forEach($),b.forEach($),this.h()},h(){K(r,"for","depth"),K(s,"class","demo-input-group"),K(E,"for","colordifference"),K(C,"class","demo-input-group"),K(Z,"for","showbounds"),K(j,"class","demo-input-group"),K(f,"class","demo-input-group"),K(e,"slot","controls")},m(u,b){V(u,e,b),_(e,s),_(s,r),_(r,h),_(r,a),_(r,i),_(s,t),L(n,s,null),_(e,q),_(e,C),_(C,E),_(E,U),_(E,Y),_(E,ie),_(C,ne),L(W,C,null),_(e,le),_(e,j),_(j,Z),_(Z,oe),_(j,fe),L(x,j,null),_(e,p),_(e,f),L(l,f,null),d=!0},p(u,b){(!d||b&8)&&he(a,u[3]);const I={};!m&&b&8&&(m=!0,I.value=u[3],de(()=>m=!1)),n.$set(I),(!d||b&32)&&he(Y,u[5]);const v={};!X&&b&32&&(X=!0,v.value=u[5],de(()=>X=!1)),W.$set(v);const D={};!ce&&b&16&&(ce=!0,D.checked=u[4],de(()=>ce=!1)),x.$set(D);const A={};b&6&&(A.onChange=u[11]),!o&&b&4&&(o=!0,A.value=u[2],de(()=>o=!1)),l.$set(A)},i(u){d||(M(n.$$.fragment,u),M(W.$$.fragment,u),M(x.$$.fragment,u),M(l.$$.fragment,u),d=!0)},o(u){Q(n.$$.fragment,u),Q(W.$$.fragment,u),Q(x.$$.fragment,u),Q(l.$$.fragment,u),d=!1},d(u){u&&$(e),B(n),B(W),B(x),B(l)}}}function qe(c){let e,s;return e=new Se({props:{caption:"Quadtree Image Compression",id:"quadtree-image-compression-demo",$$slots:{controls:[Be],canvas:[Qe]},$$scope:{ctx:c}}}),{c(){S(e.$$.fragment)},l(r){z(e.$$.fragment,r)},m(r,h){L(e,r,h),s=!0},p(r,[h]){const a={};h&8388671&&(a.$$scope={dirty:h,ctx:r}),e.$set(a)},i(r){s||(M(e.$$.fragment,r),s=!0)},o(r){Q(e.$$.fragment,r),s=!1},d(r){B(e,r)}}}const ye=1,Ae=8,Ne=0,Pe=.3;function Ve(c,e,s,r,h,a){const i=(e-c)/255,t=(r-s)/255,n=(a-h)/255;return Math.sqrt(i*i+t*t+n*n)}function We(c,e,s){let r=0,h,a,i,t=0,n=0,m,q,C="/images/starrynight.webp",E=6,U=!0,Y=.1;class ie{constructor(f,l,o=Number.POSITIVE_INFINITY){this.node=new ne(f,l),this.depth=o}insert(f,l=this.node){if(l.children===null)if(l.data){if(l.data[0]===f[0]&&l.data[1]===f[1])return;if(this.getDepth(l)>=this.depth)l.data.push(f[2],f[3],f[4]);else{const g=[...l.data];l.data=null,l.divide();for(let w=0;w<l.children.length;w++)l.children[w].data=[...g];this.insert(f,l)}}else l.data=[f[2],f[3],f[4]];else{const d=this.getIndex(l.center,f);this.insert(f,l.children[d])}}getIndex(f,l){let o=0;return o|=f[0]>l[0]?0:1,o|=f[1]>l[1]?0:2,o}getDepth(f){const l=this.node.size[0];let o=f.size[0],d=0;for(;l>o;)o*=2,d++;return d}}class ne{constructor(f,l){this.center=f,this.size=l,this.children=null,this.data=null}divide(){this.children=new Array(4);for(let f=0;f<this.children.length;f++){const l=[...this.center],o=this.size[0]*.25,d=this.size[1]*.25;(f&1)===1?l[0]+=o:l[0]-=o,(f&2)===2?l[1]+=d:l[1]-=d,this.children[f]=new ne(l,[this.size[0]*.5,this.size[1]*.5])}}}ve(()=>{i=a.getContext("2d"),h=document.getElementById("quadtree-image-compression-demo"),r=Math.floor(window.innerWidth);function p(){const l=Math.floor(window.innerWidth);l!==r&&(r=l,f())}function f(){const l=h.clientWidth,o=window.innerHeight-window.innerHeight/4;if(t=m.width,n=m.height,l>0&&o>0){if(t>l){const d=l/t;t*=d,n*=d}if(n>o){const d=o/n;t*=d,n*=d}t=Math.floor(t),n=Math.floor(n)}s(0,a.width=t,a),s(0,a.height=n,a),s(0,a.style.width=`${t}px`,a),s(0,a.style.height=`${n}px`,a),W()}return s(1,m=new Image),s(1,m.crossOrigin="anonymous",m),s(1,m.onload=f,m),s(1,m.src=C,m),window.addEventListener("resize",p,{passive:!0}),()=>{window.removeEventListener("resize",p)}});function W(){const p=document.createElement("canvas"),f=p.getContext("2d");p.width=t,p.height=n,!(t===0||n===0)&&(f.drawImage(m,0,0,m.width,m.height,0,0,t,n),q=f.getImageData(0,0,t,n).data,X())}function X(){const p=new ie([t/2,n/2],[t,n],E),f=o=>{const{center:d,size:g}=o;if(U&&(i.lineWidth=1,i.strokeStyle="black",i.fillStyle="black",i.strokeRect(d[0]-g[0]/2,d[1]-g[1]/2,g[0],g[1])),o.data){let w=0,ee=0,G=0;for(let k=0;k<o.data.length;k+=3)w+=o.data[k],ee+=o.data[k+1],G+=o.data[k+2];const se=o.data.length/3;w/=se,ee/=se,G/=se;const y=`rgb(${w},${ee},${G})`;i.fillStyle=y,i.strokeStyle=y,i.fillRect(d[0]-g[0]/2,d[1]-g[1]/2,g[0],g[1]),i.strokeRect(d[0]-g[0]/2,d[1]-g[1]/2,g[0],g[1])}if(o.children)for(let w=0;w<o.children.length;w++)f(o.children[w])};for(let o=0;o<q.length;o+=4){const d=o/4%t,g=Math.floor(o/4/t);p.insert([d,g,q[o],q[o+1],q[o+2]])}const l=(o,d)=>{let g=o,w=!1;const ee=(G,se=0)=>{if(G.children)g=G,G.children.forEach((y,k)=>ee(y,k));else{if(!g.children||se!==3)return;let y=0,k=0,re=0,u=0;for(let I=0;I<g.children.length;I++){const v=g.children[I],D=v.data.length/3;u+=D;let A=0,te=0,ae=0;for(let T=0;T<v.data.length;T+=3)y+=v.data[T],k+=v.data[T+1],re+=v.data[T+2],A+=v.data[T],te+=v.data[T+1],ae+=v.data[T+2];A/=D,te/=D,ae/=D,v.data=[A,te,ae]}y/=u,k/=u,re/=u;let b=!0;for(let I=0;I<g.children.length;I++){const v=g.children[I].data;Ve(y,v[0],k,v[1],re,v[2])>d&&(b=!1)}b&&(w=!0,g.children=null,g.data=[y,k,re])}};ee(o),w&&l(o,d)};l(p.node,Y),f(p.node)}const le=Me(X,200);function j(p){E=p,s(3,E)}function Z(p){Y=p,s(5,Y)}function oe(p){U=p,s(4,U)}const fe=()=>{s(1,m.src=C,m),X()};function x(p){C=p,s(2,C)}function ce(p){ue[p?"unshift":"push"](()=>{a=p,s(0,a)})}return[a,m,C,E,U,Y,X,le,j,Z,oe,fe,x,ce]}class xe extends $e{constructor(e){super(),_e(this,e,We,qe,be,{})}}function Te(c){let e;return{c(){e=J("Quadtree Image Compression")},l(s){e=O(s,"Quadtree Image Compression")},m(s,r){V(s,e,r)},d(s){s&&$(e)}}}function Fe(c){let e,s,r,h,a;return e=new Ee({props:{timestamp:1652155200,$$slots:{default:[Te]},$$scope:{ctx:c}}}),{c(){S(e.$$.fragment),s=N(),r=F("p"),h=J("Shades of 360p.")},l(i){z(e.$$.fragment,i),s=P(i),r=R(i,"P",{});var t=H(r);h=O(t,"Shades of 360p."),t.forEach($)},m(i,t){L(e,i,t),V(i,s,t),V(i,r,t),_(r,h),a=!0},p(i,t){const n={};t&1&&(n.$$scope={dirty:t,ctx:i}),e.$set(n)},i(i){a||(M(e.$$.fragment,i),a=!0)},o(i){Q(e.$$.fragment,i),a=!1},d(i){B(e,i),i&&$(s),i&&$(r)}}}function Re(c){let e;return{c(){e=J("Demo")},l(s){e=O(s,"Demo")},m(s,r){V(s,e,r)},d(s){s&&$(e)}}}function He(c){let e,s,r,h,a,i,t;return e=new De({props:{id:"demo",$$slots:{default:[Re]},$$scope:{ctx:c}}}),i=new xe({}),{c(){S(e.$$.fragment),s=N(),r=F("p"),h=J(`I'm noticing seams at higher depths. I assume it's due to a rounding
			error somewhere.`),a=N(),S(i.$$.fragment)},l(n){z(e.$$.fragment,n),s=P(n),r=R(n,"P",{});var m=H(r);h=O(m,`I'm noticing seams at higher depths. I assume it's due to a rounding
			error somewhere.`),m.forEach($),a=P(n),z(i.$$.fragment,n)},m(n,m){L(e,n,m),V(n,s,m),V(n,r,m),_(r,h),V(n,a,m),L(i,n,m),t=!0},p(n,m){const q={};m&1&&(q.$$scope={dirty:m,ctx:n}),e.$set(q)},i(n){t||(M(e.$$.fragment,n),M(i.$$.fragment,n),t=!0)},o(n){Q(e.$$.fragment,n),Q(i.$$.fragment,n),t=!1},d(n){B(e,n),n&&$(s),n&&$(r),n&&$(a),B(i,n)}}}function Je(c){let e,s,r,h;return e=new ge({props:{$$slots:{default:[Fe]},$$scope:{ctx:c}}}),r=new ge({props:{$$slots:{default:[He]},$$scope:{ctx:c}}}),{c(){S(e.$$.fragment),s=N(),S(r.$$.fragment)},l(a){z(e.$$.fragment,a),s=P(a),z(r.$$.fragment,a)},m(a,i){L(e,a,i),V(a,s,i),L(r,a,i),h=!0},p(a,i){const t={};i&1&&(t.$$scope={dirty:i,ctx:a}),e.$set(t);const n={};i&1&&(n.$$scope={dirty:i,ctx:a}),r.$set(n)},i(a){h||(M(e.$$.fragment,a),M(r.$$.fragment,a),h=!0)},o(a){Q(e.$$.fragment,a),Q(r.$$.fragment,a),h=!1},d(a){B(e,a),a&&$(s),B(r,a)}}}function Oe(c){let e,s,r,h,a,i;return e=new Ie({props:{title:"Quadtree Image Compression",description:"Compress an image using a Quadtree",keywords:"Javascript, Creative Coding, Quadtree, Image Compression, Image Processing"}}),r=new Ce({props:{$$slots:{default:[Je]},$$scope:{ctx:c}}}),a=new ke({}),{c(){S(e.$$.fragment),s=N(),S(r.$$.fragment),h=N(),S(a.$$.fragment)},l(t){z(e.$$.fragment,t),s=P(t),z(r.$$.fragment,t),h=P(t),z(a.$$.fragment,t)},m(t,n){L(e,t,n),V(t,s,n),L(r,t,n),V(t,h,n),L(a,t,n),i=!0},p(t,[n]){const m={};n&1&&(m.$$scope={dirty:n,ctx:t}),r.$set(m)},i(t){i||(M(e.$$.fragment,t),M(r.$$.fragment,t),M(a.$$.fragment,t),i=!0)},o(t){Q(e.$$.fragment,t),Q(r.$$.fragment,t),Q(a.$$.fragment,t),i=!1},d(t){B(e,t),t&&$(s),B(r,t),t&&$(h),B(a,t)}}}class tt extends $e{constructor(e){super(),_e(this,e,null,Oe,be,{})}}export{tt as default};
