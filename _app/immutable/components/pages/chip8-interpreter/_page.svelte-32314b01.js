import{S as Z,i as Y,s as ee,w as H,x as N,y as U,f as V,t as q,z as W,o as te,k as m,l as b,m as _,h as l,n as z,b as A,B as se,q as w,a as L,r as I,c as R,M as ie,G as f,N as X,K as j,O as ae,P as re,I as oe}from"../../../chunks/index-06b4769f.js";import{M as ne,S as ce,T as he}from"../../../chunks/Main-70a15631.js";import{S as le}from"../../../chunks/Seo-a1f82edf.js";import{D as fe}from"../../../chunks/DemoContainer-627a66be.js";function xe(p){let t;return{c(){t=m("canvas"),this.h()},l(o){t=b(o,"CANVAS",{slot:!0,class:!0}),_(t).forEach(l),this.h()},h(){z(t,"slot","canvas"),z(t,"class","svelte-nzknsg")},m(o,i){A(o,t,i),p[6](t)},p:se,d(o){o&&l(t),p[6](null)}}}function pe(p){let t,o,i,h,r,c,k,C,d,v,u,S,$,g,M,K,E,D,B,a;return{c(){t=m("fieldset"),o=m("div"),i=m("label"),h=w("ROM"),r=L(),c=m("select"),k=m("option"),C=w("IBM Logo"),d=m("option"),v=w("Test Opcode"),u=m("option"),S=w("Maze"),$=m("option"),g=w("Breakout"),M=L(),K=m("div"),E=m("button"),D=w("Reset"),this.h()},l(e){t=b(e,"FIELDSET",{slot:!0});var s=_(t);o=b(s,"DIV",{class:!0});var n=_(o);i=b(n,"LABEL",{for:!0});var y=_(i);h=I(y,"ROM"),y.forEach(l),r=R(n),c=b(n,"SELECT",{id:!0});var x=_(c);k=b(x,"OPTION",{default:!0});var P=_(k);C=I(P,"IBM Logo"),P.forEach(l),d=b(x,"OPTION",{});var T=_(d);v=I(T,"Test Opcode"),T.forEach(l),u=b(x,"OPTION",{});var O=_(u);S=I(O,"Maze"),O.forEach(l),$=b(x,"OPTION",{});var G=_($);g=I(G,"Breakout"),G.forEach(l),x.forEach(l),n.forEach(l),M=R(s),K=b(s,"DIV",{class:!0});var J=_(K);E=b(J,"BUTTON",{});var Q=_(E);D=I(Q,"Reset"),Q.forEach(l),J.forEach(l),s.forEach(l),this.h()},h(){z(i,"for","rom"),z(k,"default",""),k.__value="/chip8/ibm_logo.ch8",k.value=k.__value,d.__value="/chip8/test_opcode.ch8",d.value=d.__value,u.__value="/chip8/maze.rom",u.value=u.__value,$.__value="/chip8/breakout.rom",$.value=$.__value,z(c,"id","rom"),p[2]===void 0&&ie(()=>p[3].call(c)),z(o,"class","demo-input-group"),z(K,"class","demo-input-group run svelte-nzknsg"),z(t,"slot","controls")},m(e,s){A(e,t,s),f(t,o),f(o,i),f(i,h),f(o,r),f(o,c),f(c,k),f(k,C),f(c,d),f(d,v),f(c,u),f(u,S),f(c,$),f($,g),X(c,p[2],!0),f(t,M),f(t,K),f(K,E),f(E,D),B||(a=[j(c,"change",p[3]),j(c,"change",p[4]),j(E,"click",p[5])],B=!0)},p(e,s){s&4&&X(c,e[2])},d(e){e&&l(t),B=!1,ae(a)}}}function de(p){let t,o;return t=new fe({props:{id:"container",caption:"CHIP-8 Interpreter",$$slots:{controls:[pe],canvas:[xe]},$$scope:{ctx:p}}}),{c(){H(t.$$.fragment)},l(i){N(t.$$.fragment,i)},m(i,h){U(t,i,h),o=!0},p(i,[h]){const r={};h&131079&&(r.$$scope={dirty:h,ctx:i}),t.$set(r)},i(i){o||(V(t.$$.fragment,i),o=!0)},o(i){q(t.$$.fragment,i),o=!1},d(i){W(t,i)}}}const F=64,ke=32;function ue(p,t,o){let i,h,r=0,c=0;const k=[240,144,144,144,240,32,96,32,32,112,240,16,240,128,240,240,16,240,16,240,144,144,240,16,16,240,128,240,16,240,240,128,240,144,240,240,16,32,64,64,240,144,240,144,240,240,144,240,16,240,240,144,240,144,144,224,144,224,144,224,240,128,128,128,240,224,144,144,144,224,240,128,240,128,240,240,128,240,128,128];class C{constructor(){this.ram=null,this.registers=null,this.stack=null,this.display=null,this.keypad=null,this.index=null,this.delay=null,this.sound=null,this.pc=null,this.sp=null,this.opcode=null;const e=n=>{switch(n.code){case"Digit1":this.keypad[1]=1;break;case"Digit2":this.keypad[2]=1;break;case"Digit3":this.keypad[3]=1;break;case"Digit4":this.keypad[12]=1;break;case"KeyQ":this.keypad[4]=1;break;case"KeyW":this.keypad[5]=1;break;case"KeyE":this.keypad[6]=1;break;case"KeyR":this.keypad[13]=1;break;case"KeyA":this.keypad[7]=1;break;case"KeyS":this.keypad[8]=1;break;case"KeyD":this.keypad[9]=1;break;case"KeyF":this.keypad[14]=1;break;case"KeyZ":this.keypad[10]=1;break;case"KeyX":this.keypad[0]=1;break;case"KeyC":this.keypad[11]=1;break;case"KeyV":this.keypad[15]=1;break;default:return}},s=n=>{switch(n.code){case"Digit1":this.keypad[1]=0;break;case"Digit2":this.keypad[2]=0;break;case"Digit3":this.keypad[3]=0;break;case"Digit4":this.keypad[12]=0;break;case"KeyQ":this.keypad[4]=0;break;case"KeyW":this.keypad[5]=0;break;case"KeyE":this.keypad[6]=0;break;case"KeyR":this.keypad[13]=0;break;case"KeyA":this.keypad[7]=0;break;case"KeyS":this.keypad[8]=0;break;case"KeyD":this.keypad[9]=0;break;case"KeyF":this.keypad[14]=0;break;case"KeyZ":this.keypad[10]=0;break;case"KeyX":this.keypad[0]=0;break;case"KeyC":this.keypad[11]=0;break;case"KeyV":this.keypad[15]=0;break;default:return}};window.addEventListener("keydown",e,{passive:!0}),window.addEventListener("keyup",s,{passive:!0})}init(){this.ram=new Uint8Array(4096),this.registers=new Uint8Array(16),this.stack=new Uint16Array(16),this.display=new Uint8Array(64*32),this.keypad=new Uint8Array(16),this.index=0,this.delay=0,this.sound=0,this.pc=512,this.sp=0,this.opcode=0;for(let e=0;e<k.length;e++)this.ram[e+80]=k[e]}async load(e){const n=await(await fetch(e).then(x=>x.blob())).arrayBuffer(),y=new Uint8Array(n);this.init();for(let x=0;x<y.length;x++)this.ram[x+512]=y[x]}cycle(){switch(this.opcode=this.ram[this.pc]<<8|this.ram[this.pc+1],this.pc+=2,this.opcode&61440){case 0:{switch(this.opcode&255){case 224:{for(let s=0;s<this.display.length;s++)this.display[s]=0;break}case 238:{this.sp--,this.pc=this.stack[this.sp];break}}break}case 4096:{this.pc=this.opcode&4095;break}case 8192:{const e=this.opcode&4095;this.stack[this.sp]=this.pc,this.sp++,this.pc=e;break}case 12288:{const e=(this.opcode&3840)>>8,s=this.opcode&255;this.registers[e]===s&&(this.pc+=2);break}case 16384:{const e=(this.opcode&3840)>>8,s=this.opcode&255;this.registers[e]!==s&&(this.pc+=2);break}case 20480:{const e=(this.opcode&3840)>>8,s=(this.opcode&240)>>4;this.registers[e]===this.registers[s]&&(this.pc+=2);break}case 24576:{const e=(this.opcode&3840)>>8,s=this.opcode&255;this.registers[e]=s;break}case 28672:{const e=(this.opcode&3840)>>8,s=this.opcode&255;this.registers[e]+=s;break}case 32768:{const e=(this.opcode&3840)>>8,s=(this.opcode&240)>>4;switch(this.opcode&15){case 0:{this.registers[e]=this.registers[s];break}case 1:{this.registers[e]|=this.registers[s];break}case 2:{this.registers[e]&=this.registers[s];break}case 3:{this.registers[e]^=this.registers[s];break}case 4:{this.registers[e]+this.registers[s]>(1<<8)-1?this.registers[15]=1:this.registers[15]=0,this.registers[e]+=this.registers[s];break}case 5:{this.registers[e]<this.registers[s]?this.registers[15]=0:this.registers[15]=1,this.registers[e]-=this.registers[s];break}case 6:{this.registers[15]=this.registers[e]&1,this.registers[e]>>=1;break}case 7:{this.registers[s]<this.registers[e]?this.registers[15]=0:this.registers[15]=1,this.registers[e]=this.registers[s]-this.registers[e];break}case 14:{this.registers[15]=(this.registers[e]&128)>>7,this.registers[e]<<=1;break}}break}case 36864:{const e=(this.opcode&3840)>>8,s=(this.opcode&240)>>4;this.registers[e]!==this.registers[s]&&(this.pc+=2);break}case 40960:{this.index=this.opcode&4095;break}case 45056:{const e=this.opcode&4095;this.pc=e+this.registers[0];break}case 49152:{const e=(this.opcode&3840)>>8,s=this.opcode&255;this.registers[e]=this.random()&s;break}case 53248:{const e=this.registers[(this.opcode&3840)>>8],s=this.registers[(this.opcode&240)>>4],n=this.opcode&15;this.registers[15]=0;for(let y=0;y<n;y++){const x=this.ram[this.index+y];for(let P=0;P<8;P++){const T=128>>P;if(x&T){const O=e+P+(s+y)*64;this.display[O]===1&&(this.registers[15]=1),this.display[O]^=1}}}break}case 57344:{const e=(this.opcode&3840)>>8;switch(this.opcode&255){case 158:{this.keypad[this.registers[e]]===1&&(this.pc+=2);break}case 161:{this.keypad[this.registers[e]]===0&&(this.pc+=2);break}}break}case 61440:{const e=(this.opcode&3840)>>8;switch(this.opcode&255){case 7:{this.registers[e]=this.delay;break}case 10:{this.keypad[0]?this.registers[e]=0:this.keypad[1]?this.registers[e]=1:this.keypad[2]?this.registers[e]=2:this.keypad[3]?this.registers[e]=3:this.keypad[4]?this.registers[e]=4:this.keypad[5]?this.registers[e]=5:this.keypad[6]?this.registers[e]=6:this.keypad[7]?this.registers[e]=7:this.keypad[8]?this.registers[e]=8:this.keypad[9]?this.registers[e]=9:this.keypad[10]?this.registers[e]=10:this.keypad[11]?this.registers[e]=11:this.keypad[12]?this.registers[e]=12:this.keypad[13]?this.registers[e]=13:this.keypad[14]?this.registers[e]=14:this.keypad[15]?this.registers[e]=15:this.pc-=2;break}case 21:{this.delay=this.registers[e];break}case 24:{this.sound=this.registers[e];break}case 30:{this.index+=this.registers[e];break}case 41:{const n=80+e*5;this.index=n;break}case 51:{let n=this.registers[e],y=0,x=0,P=0;for(;n-100>=0;)n-=100,y++;for(;n-10>=0;)n-=10,x++;for(;n-1>=0;)n-=1,P++;this.ram[this.index]=y,this.ram[this.index+1]=x,this.ram[this.index+2]=P;break}case 85:{for(let n=0;n<=e;n++)this.ram[this.index+n]=this.registers[n];break}case 101:{for(let n=0;n<=e;n++)this.registers[n]=this.ram[this.index+n];break}}break}}this.delay>0&&this.delay--,this.sound>0&&this.sound--}random(){return Math.floor(Math.random()*256)}}class d{constructor(e){this.canvas=e,this.ctx=this.canvas.getContext("2d")}resize(){this.canvas.width=r,this.canvas.height=c,this.canvas.style.width=`${r}px`,this.canvas.style.height=`${c}px`,this.ctx.clearRect(0,0,r,c),this.imageData=this.ctx.getImageData(0,0,r,c)}draw(e){for(let s=0;s<r;s++)for(let n=0;n<c;n++){const y=Math.floor(s/r*64),x=Math.floor(n/c*32),P=Math.floor(y+x*64),T=e[P]*255,O=Math.floor(s*4+n*r*4);this.imageData.data[O]=T,this.imageData.data[O+1]=T,this.imageData.data[O+2]=T,this.imageData.data[O+3]=255}this.ctx.putImageData(this.imageData,0,0)}}let v,u;const S=1e3/60;let $=0,g="/chip8/ibm_logo.ch8";te(()=>{i=document.getElementById("container");function a(){const e=i.clientWidth;r=F;let s=1;for(;r<=e-F;)r+=F,s++;c=ke*s,u.resize()}return window.addEventListener("resize",a,{passive:!0}),o(1,v=new C),u=new d(h),v.load(g).then(()=>{a(),M()}),()=>{window.removeEventListener("resize",a)}});function M(a=0){a-$>S&&(v.cycle(),u.draw(v.display),$=a),window.requestAnimationFrame(M)}function K(){g=re(this),o(2,g)}const E=()=>{v.load(g)},D=()=>v.load(g);function B(a){oe[a?"unshift":"push"](()=>{h=a,o(0,h)})}return[h,v,g,K,E,D,B]}class ye extends Z{constructor(t){super(),Y(this,t,ue,de,ee,{})}}function ge(p){let t;return{c(){t=w("CHIP-8 Interpreter")},l(o){t=I(o,"CHIP-8 Interpreter")},m(o,i){A(o,t,i)},d(o){o&&l(t)}}}function me(p){let t,o,i,h,r,c,k,C,d,v,u,S,$,g,M,K,E,D,B;return t=new he({props:{timestamp:1655577363,$$slots:{default:[ge]},$$scope:{ctx:p}}}),D=new ye({}),{c(){H(t.$$.fragment),o=L(),i=m("p"),h=w(`It's my first time coding an emulator/interpreter. I've heard that
			this is a very common starter project for people who want to try
			their hands at something more complex like a NES or a GBA.`),r=L(),c=m("p"),k=w("Didn't implement audio."),C=L(),d=m("p"),v=w("Breakout demo: use "),u=m("var"),S=w("q"),$=w(" and "),g=m("var"),M=w("e"),K=w(" to move."),E=L(),H(D.$$.fragment)},l(a){N(t.$$.fragment,a),o=R(a),i=b(a,"P",{});var e=_(i);h=I(e,`It's my first time coding an emulator/interpreter. I've heard that
			this is a very common starter project for people who want to try
			their hands at something more complex like a NES or a GBA.`),e.forEach(l),r=R(a),c=b(a,"P",{});var s=_(c);k=I(s,"Didn't implement audio."),s.forEach(l),C=R(a),d=b(a,"P",{});var n=_(d);v=I(n,"Breakout demo: use "),u=b(n,"VAR",{});var y=_(u);S=I(y,"q"),y.forEach(l),$=I(n," and "),g=b(n,"VAR",{});var x=_(g);M=I(x,"e"),x.forEach(l),K=I(n," to move."),n.forEach(l),E=R(a),N(D.$$.fragment,a)},m(a,e){U(t,a,e),A(a,o,e),A(a,i,e),f(i,h),A(a,r,e),A(a,c,e),f(c,k),A(a,C,e),A(a,d,e),f(d,v),f(d,u),f(u,S),f(d,$),f(d,g),f(g,M),f(d,K),A(a,E,e),U(D,a,e),B=!0},p(a,e){const s={};e&1&&(s.$$scope={dirty:e,ctx:a}),t.$set(s)},i(a){B||(V(t.$$.fragment,a),V(D.$$.fragment,a),B=!0)},o(a){q(t.$$.fragment,a),q(D.$$.fragment,a),B=!1},d(a){W(t,a),a&&l(o),a&&l(i),a&&l(r),a&&l(c),a&&l(C),a&&l(d),a&&l(E),W(D,a)}}}function be(p){let t,o;return t=new ce({props:{$$slots:{default:[me]},$$scope:{ctx:p}}}),{c(){H(t.$$.fragment)},l(i){N(t.$$.fragment,i)},m(i,h){U(t,i,h),o=!0},p(i,h){const r={};h&1&&(r.$$scope={dirty:h,ctx:i}),t.$set(r)},i(i){o||(V(t.$$.fragment,i),o=!0)},o(i){q(t.$$.fragment,i),o=!1},d(i){W(t,i)}}}function _e(p){let t,o,i,h;return t=new le({props:{title:"CHIP-8 Interpreter",description:"Javascript CHIP-8 Interpreter",keywords:"CHIP-8, Javascript, Emulator, Interpreter"}}),i=new ne({props:{$$slots:{default:[be]},$$scope:{ctx:p}}}),{c(){H(t.$$.fragment),o=L(),H(i.$$.fragment)},l(r){N(t.$$.fragment,r),o=R(r),N(i.$$.fragment,r)},m(r,c){U(t,r,c),A(r,o,c),U(i,r,c),h=!0},p(r,[c]){const k={};c&1&&(k.$$scope={dirty:c,ctx:r}),i.$set(k)},i(r){h||(V(t.$$.fragment,r),V(i.$$.fragment,r),h=!0)},o(r){q(t.$$.fragment,r),q(i.$$.fragment,r),h=!1},d(r){W(t,r),r&&l(o),W(i,r)}}}class Ee extends Z{constructor(t){super(),Y(this,t,null,_e,ee,{})}}export{Ee as default};
