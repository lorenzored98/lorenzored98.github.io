import{S as ne,i as se,s as ae,w as W,x as N,y as A,f as B,t as P,z as V,o as fe,k,l as y,m as T,h as v,n as G,b as x,B as me,J as X,K as Z,q as L,a as H,r as Q,c as K,G as E,u as he,M as U}from"../../../chunks/index-3b14b416.js";import{M as ge,S as pe,T as de}from"../../../chunks/Main-bd282878.js";/* empty css                                                             */import{S as $e}from"../../../chunks/Seo-3503e59c.js";import{D as _e}from"../../../chunks/DemoContainer-7bda57f4.js";import{I as be}from"../../../chunks/ImageSelect-5128dae4.js";import{N as we}from"../../../chunks/NumberRange-cdc40157.js";import{d as ve}from"../../../chunks/core-ddcb889b.js";function ze(l){let e;return{c(){e=k("canvas"),this.h()},l(n){e=y(n,"CANVAS",{slot:!0,class:!0}),T(e).forEach(v),this.h()},h(){G(e,"slot","canvas"),G(e,"class","svelte-10p45u9")},m(n,s){x(n,e,s),l[9](e)},p:me,d(n){n&&v(e),l[9](null)}}}function Ie(l){let e,n,s,u,o,p,h,$,_,b,c,d,I,a;function g(m){l[6](m)}let z={id:"colors",min:Ee,max:De,step:1,onChange:l[5]};l[2]!==void 0&&(z.value=l[2]),$=new we({props:z}),X.push(()=>Z($,"value",g));function q(m){l[8](m)}let R={id:"image-select",onChange:l[7]};return l[3]!==void 0&&(R.value=l[3]),d=new be({props:R}),X.push(()=>Z(d,"value",q)),{c(){e=k("fieldset"),n=k("div"),s=k("label"),u=L("Colors: ("),o=L(l[2]),p=L(")"),h=H(),W($.$$.fragment),b=H(),c=k("div"),W(d.$$.fragment),this.h()},l(m){e=y(m,"FIELDSET",{slot:!0});var C=T(e);n=y(C,"DIV",{class:!0});var S=T(n);s=y(S,"LABEL",{for:!0});var O=T(s);u=Q(O,"Colors: ("),o=Q(O,l[2]),p=Q(O,")"),O.forEach(v),h=K(S),N($.$$.fragment,S),S.forEach(v),b=K(C),c=y(C,"DIV",{class:!0});var j=T(c);N(d.$$.fragment,j),j.forEach(v),C.forEach(v),this.h()},h(){G(s,"for","colors"),G(n,"class","demo-input-group"),G(c,"class","demo-input-group"),G(e,"slot","controls")},m(m,C){x(m,e,C),E(e,n),E(n,s),E(s,u),E(s,o),E(s,p),E(n,h),A($,n,null),E(e,b),E(e,c),A(d,c,null),a=!0},p(m,C){(!a||C&4)&&he(o,m[2]);const S={};!_&&C&4&&(_=!0,S.value=m[2],U(()=>_=!1)),$.$set(S);const O={};C&10&&(O.onChange=m[7]),!I&&C&8&&(I=!0,O.value=m[3],U(()=>I=!1)),d.$set(O)},i(m){a||(B($.$$.fragment,m),B(d.$$.fragment,m),a=!0)},o(m){P($.$$.fragment,m),P(d.$$.fragment,m),a=!1},d(m){m&&v(e),V($),V(d)}}}function Ce(l){let e,n;return e=new _e({props:{caption:"Octree Color Quantization",id:"octree-color-quantization-demo",$$slots:{controls:[Ie],canvas:[ze]},$$scope:{ctx:l}}}),{c(){W(e.$$.fragment)},l(s){N(e.$$.fragment,s)},m(s,u){A(e,s,u),n=!0},p(s,[u]){const o={};u&33554447&&(o.$$scope={dirty:u,ctx:s}),e.$set(o)},i(s){n||(B(e.$$.fragment,s),n=!0)},o(s){P(e.$$.fragment,s),n=!1},d(s){V(e,s)}}}const Ee=1,De=255,ee=256,Oe=8;function te(l,e,n){return l+","+e+","+n}function Se(l,e,n){class s{constructor(r,t,i=Number.POSITIVE_INFINITY){this.node=new u(r,t),this.depth=i}insert(r,t=this.node){if(t.children===null)if(t.data){if(t.data[0]===r[0]&&t.data[1]===r[1]&&t.data[2]===r[2]||this.getDepth(t)>=this.depth)return;const M=[...t.data];t.data=null,t.divide();const Y=this.getIndex(t.center,M);t.children[Y].data=M,this.insert(r,t)}else t.data=r;else{const w=this.getIndex(t.center,r);this.insert(r,t.children[w])}}getIndex(r,t){let i=0;return i|=r[1]>t[1]?0:4,i|=r[0]>t[0]?0:2,i|=r[2]>t[2]?0:1,i}getDepth(r){let t=r.size,i=0;for(;this.node.size>t;)t*=2,i++;return i}dfs(r,t=this.node){const i=w=>{r(w),w.children&&w.children.forEach(M=>i(M))};i(t)}}class u{constructor(r,t){this.center=r,this.size=t,this.children=null,this.data=null}divide(){this.children=new Array(8);for(let r=0;r<this.children.length;r++){const t=[...this.center],i=this.size*.25;(r&4)===4?t[1]+=i:t[1]-=i,(r&2)===2?t[0]+=i:t[0]-=i,(r&1)===1?t[2]+=i:t[2]-=i,this.children[r]=new u(t,this.size*.5)}}}let o=0,p,h,$,_=0,b=0,c,d=8,I="/images/ukiyo-e.webp",a,g,z=[];const q=ee/2;let R;fe(()=>{$=h.getContext("2d"),p=document.getElementById("octree-color-quantization-demo"),o=Math.floor(window.innerWidth);function f(){const t=Math.floor(window.innerWidth);t!==o&&(o=t,r())}function r(){const t=p.clientWidth,i=window.innerHeight-window.innerHeight/4;if(_=c.width,b=c.height,t>0&&i>0){if(_>t){const w=t/_;_*=w,b*=w}if(b>i){const w=i/b;_*=w,b*=w}_=Math.floor(_),b=Math.floor(b)}n(0,h.width=_,h),n(0,h.height=b,h),n(0,h.style.width=`${_}px`,h),n(0,h.style.height=`${b}px`,h),m()}return n(1,c=new Image),n(1,c.crossOrigin="anonymous",c),n(1,c.onload=r,c),n(1,c.src=I,c),window.addEventListener("resize",f,{passive:!0}),()=>{window.removeEventListener("resize",f)}});function m(){if(R=new s([q,q,q],ee,Oe),!(_===0||b===0)){$.drawImage(c,0,0,c.width,c.height,0,0,_,b),a=$.getImageData(0,0,_,b),g=[...a.data];for(let f=0;f<a.data.length;f+=4)R.insert([g[f],g[f+1],g[f+2]]);z=[],O(),C()}}function C(){const f=j(d),r=a.data;for(let t=0;t<r.length;t+=4){const i=te(g[t],g[t+1],g[t+2]),w=f[i];r[t]=w[0],r[t+1]=w[1],r[t+2]=w[2]}$.putImageData(a,0,0)}const S=ve(C,100);function O(){R.dfs(f=>{const r=[];R.dfs(t=>{t.data!==null&&r.push(t.data[0],t.data[1],t.data[2])},f),z.push(r)}),z.sort((f,r)=>f.length>r.length?-1:r.length>f.length?1:0)}function j(f){const r={};for(let t=0;t<f;t++){const i=z[t];let w=[],M=0,Y=0,F=0;for(let D=0;D<i.length;D+=3){const ue=te(i[D],i[D+1],i[D+2]);w.push(ue),M+=i[D],Y+=i[D+1],F+=i[D+2]}const J=i.length/3;M/=J,Y/=J,F/=J;const ce=[M,Y,F];for(let D=0;D<w.length;D++)r[w[D]]=ce}return r}function re(f){d=f,n(2,d)}const oe=()=>{n(1,c.src=I,c),m()};function ie(f){I=f,n(3,I)}function le(f){X[f?"unshift":"push"](()=>{h=f,n(0,h)})}return[h,c,d,I,m,S,re,oe,ie,le]}class xe extends ne{constructor(e){super(),se(this,e,Se,Ce,ae,{})}}function qe(l){let e;return{c(){e=L("Octree Color Quantization")},l(n){e=Q(n,"Octree Color Quantization")},m(n,s){x(n,e,s)},d(n){n&&v(e)}}}function Me(l){let e,n,s,u,o,p,h,$,_,b,c,d,I;return e=new de({props:{timestamp:1652328e3,$$slots:{default:[qe]},$$scope:{ctx:l}}}),d=new xe({}),{c(){W(e.$$.fragment),n=H(),s=k("p"),u=L(`Imagine an Octree as a XYZ axes plot in 3D space. We can insert a
			RGB color by using each the red, green, and blue channels as its
			coordinates.`),o=H(),p=k("p"),h=L(`Then we pick the smallest possible sub-cube that contains the number
			of colors specified in the `),$=k("var"),_=L("quantization"),b=L(" function."),c=H(),W(d.$$.fragment)},l(a){N(e.$$.fragment,a),n=K(a),s=y(a,"P",{});var g=T(s);u=Q(g,`Imagine an Octree as a XYZ axes plot in 3D space. We can insert a
			RGB color by using each the red, green, and blue channels as its
			coordinates.`),g.forEach(v),o=K(a),p=y(a,"P",{});var z=T(p);h=Q(z,`Then we pick the smallest possible sub-cube that contains the number
			of colors specified in the `),$=y(z,"VAR",{});var q=T($);_=Q(q,"quantization"),q.forEach(v),b=Q(z," function."),z.forEach(v),c=K(a),N(d.$$.fragment,a)},m(a,g){A(e,a,g),x(a,n,g),x(a,s,g),E(s,u),x(a,o,g),x(a,p,g),E(p,h),E(p,$),E($,_),E(p,b),x(a,c,g),A(d,a,g),I=!0},p(a,g){const z={};g&1&&(z.$$scope={dirty:g,ctx:a}),e.$set(z)},i(a){I||(B(e.$$.fragment,a),B(d.$$.fragment,a),I=!0)},o(a){P(e.$$.fragment,a),P(d.$$.fragment,a),I=!1},d(a){V(e,a),a&&v(n),a&&v(s),a&&v(o),a&&v(p),a&&v(c),V(d,a)}}}function ke(l){let e,n;return e=new pe({props:{$$slots:{default:[Me]},$$scope:{ctx:l}}}),{c(){W(e.$$.fragment)},l(s){N(e.$$.fragment,s)},m(s,u){A(e,s,u),n=!0},p(s,u){const o={};u&1&&(o.$$scope={dirty:u,ctx:s}),e.$set(o)},i(s){n||(B(e.$$.fragment,s),n=!0)},o(s){P(e.$$.fragment,s),n=!1},d(s){V(e,s)}}}function ye(l){let e,n,s,u;return e=new $e({props:{title:"Octree Color Quantization",description:"Using an octree to color quantize an image",keywords:"Octree, Javascript, Image Processing, Quantization, Canvas2D"}}),s=new ge({props:{$$slots:{default:[ke]},$$scope:{ctx:l}}}),{c(){W(e.$$.fragment),n=H(),W(s.$$.fragment)},l(o){N(e.$$.fragment,o),n=K(o),N(s.$$.fragment,o)},m(o,p){A(e,o,p),x(o,n,p),A(s,o,p),u=!0},p(o,[p]){const h={};p&1&&(h.$$scope={dirty:p,ctx:o}),s.$set(h)},i(o){u||(B(e.$$.fragment,o),B(s.$$.fragment,o),u=!0)},o(o){P(e.$$.fragment,o),P(s.$$.fragment,o),u=!1},d(o){V(e,o),o&&v(n),V(s,o)}}}class Ve extends ne{constructor(e){super(),se(this,e,null,ye,ae,{})}}export{Ve as default};
